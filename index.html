






<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <meta charset="utf-8">
    <title>GIS ëª¨ë°”ì¼</title>
<link rel="icon" href="https://hamancctv.github.io/5/favicon.ico" sizes="32x32"/>
	
</head>

<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>GIS ëª¨ë°”ì¼</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link rel="icon" href="https://hamancctv.github.io/5/favicon.ico" sizes="32x32"/>

  <style>
    /* ì§€ë„ ì „ì²´ì—ì„œ í…ìŠ¤íŠ¸ ì„ íƒ ë°©ì§€ */
    #map, #map * {
        user-select: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        -khtml-user-select: none;
    }
    /* ì…ë ¥ ê°€ëŠ¥í•œ ì˜ì—­ì€ ì„ íƒ ê°€ëŠ¥ */


    #container {overflow:hidden;height:100%;position:relative;}
    #mapWrapper {width:100%;height:100%;z-index:1;}
    #rvWrapper {width:50%;height:100%;top:0;right:0;position:absolute;z-index:0;}
    #container.view_roadview #mapWrapper {width: 50%;}
    #roadviewControl {
        position:absolute;top:2px;left:115px;width:42px;height:42px;
        z-index: 1;cursor: pointer;
        background: url(https://t1.daumcdn.net/localimg/localimages/07/2018/pc/common/img_search.png) 0 -450px no-repeat;
    }
    #roadviewControl.active {background-position:0 -350px;}
    #close {
        position: absolute;padding: 4px;top: 49px;left: 5px;cursor: pointer;
        background: #fff;border-radius: 4px;border: 1px solid #c8c8c8;box-shadow: 0px 1px #888;
    }
    #close .img {
        display: block;
        background: url(https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/rv_close.png) no-repeat;
        width: 14px;height: 14px;
    }

 /* í•˜ë‹¨ ì»¨íŠ¸ë¡¤ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ê°œì„  */
.custom_typecontrol2_m {
    position: absolute;
    bottom: 15px;
    right: 15px;
    display: flex;
    gap: 8px; /* ë²„íŠ¼ ì‚¬ì´ ê°„ê²© */
    z-index: 10;
    font-family: 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', sans-serif;
}

.custom_typecontrol2_m span {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 50px;
    height: 36px;
    padding: 0 12px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    border-radius: 8px;
    border: 1px solid #ccc;
    background: #f0f0f0;
    color: #333;
    box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    transition: all 0.2s ease;
    user-select: none;
}

/* í˜¸ë²„ íš¨ê³¼ */
.custom_typecontrol2_m span:hover {
    background: linear-gradient(145deg, #e0e0e0, #d1d1d1);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

/* í´ë¦­/ì„ íƒëœ ë²„íŠ¼ */
.custom_typecontrol2_m span.selected_btn {
    background: linear-gradient(145deg, #425470, #5b6d8a);
    color: #fff;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    border-color: #2e3d5c;
}

/* í´ë¦­ ì‹œ ëˆ„ë¥¸ ëŠë‚Œ */
.custom_typecontrol2_m span:active {
    background: linear-gradient(145deg, #3a4b66, #52647e);
}

    /* ê³µí†µ ë²„íŠ¼ */
    .btn-common {
        height: 32px;
        padding: 0 10px;
        border: 1px solid #ccc;
        background: #f8f9fa;
        border-radius: 6px;
        font-size: 14px;
        cursor: pointer;
        z-index: 200;
    }
    .btn-common:hover { background: #e9ecef; }
    .btn-primary {
        background: #4caf50;
        color: white;
        border: none;
    }
    .btn-primary:hover { background: #43a047; }

    /* ê³µí†µ input */
    .input-common {
        height: 32px;
        padding: 0 8px;
        border: 1px solid #ccc;
        border-radius: 6px;
        font-size: 14px;
        z-index: 200;
    }

    /* ìƒë‹¨ íˆ´ë°” */
    .toolbar {
        position: absolute;
        top: 12px;
        left: 10px;
        display: flex;
        gap: 6px;
        align-items: center;
        z-index: 500;
    }
    .toolbar-right {
        position: absolute;
        top: 12px;
        right: 10px;
        display: flex;
        gap: 6px;
        align-items: center;
        z-index: 500;
    }

    html, body {width:100%;height:100%;margin:0;padding:0;overflow:hidden;}

    #menu_wrap {
        position:absolute;top:40px;right:8px;bottom:70%;
        width:270px;margin:3px 0 5px 10px;padding:5px;
        overflow-y:auto;background:rgba(255, 255, 255, 0.8);
        z-index: 1;font-size:12px;
    }

    /* ì•Œë¦¼ ì˜¤ë²„ë ˆì´ */
    #alert-overlay {
        position: fixed;
        top: 50px;
        left: 50%;
        transform: translateX(-50%);
        background-color: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 15px 30px;
        border-radius: 8px;
        z-index: 1000;
        display: none;
        font-size: 1.2em;
        font-weight: bold;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
      
  /* ê²€ìƒ‰ì°½ ì»¨í…Œì´ë„ˆ */
.search-container {
  position: absolute;
  top: 3px;                /* ì§€ë„ ìƒë‹¨ì—ì„œ ì•½ê°„ ì•„ë˜ */
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  align-items: center;
  width: 400px;             /* ì „ì²´ ê°€ë¡œ í­ */
  z-index: 500;
}

/* ì…ë ¥ì°½ */
.search-container input {
  flex: 1;
  height: 36px;
  padding: 0 10px;
  border: 1px solid #ccc;
  border-radius: 6px 0 0 6px;
  font-size: 14px;
      margin-right: 6px; /* â† ë²„íŠ¼ê³¼ì˜ ê°„ê²© ì¶”ê°€ */

}

/* ë²„íŠ¼ */
.search-container button {
  height: 36px;
  padding: 0 15px;
  border: 1px solid #ccc;
  border-left: none;
  border-radius: 0 6px 6px 0;
  background: #4caf50;
  color: #fff;
  cursor: pointer;
}

.search-container button:hover {
  background: #43a047;
}
      
#btnDistance {
    position:absolute; top:50px; left:10px; z-index:1000;
    display:inline-flex; align-items:center; justify-content:center;
    padding:6px 12px; border-radius:6px; border:1px solid #666;
    background:#fff; color:#000; cursor:pointer;
    font-size:14px; font-weight:500; transition: background 0.2s,color 0.2s;
}
    #btnDistance.active { background:#db4040; color:#fff; }
.labelBox {
    background:#fff; border:1px solid #555; border-radius:3px;
    font-size:12px; padding:2px 6px; cursor:pointer;
}
.totalBox {
    background:#ffeb3b; border:1px solid #333; border-radius:3px;
    font-size:12px; padding:2px 6px; font-weight:bold;
}
  </style>
</head>
<body>
  <div id="alert-overlay"><div id="alert-message"></div></div>
<button id="btnDistance">ê±°ë¦¬</button>

  <div id="container">
      <div id="rvWrapper">
          <div id="roadview" style="width:100%;height:100%;"></div>
          <div id="close" title="ë¡œë“œë·°ë‹«ê¸°" onclick="closeRoadview()"><span class="img"></span></div>
      </div>
      <div id="mapWrapper">
          <div id="map" style="width:100%;height:100%"></div>
          <div id="roadviewControl" onclick="setRoadviewRoad()"></div>
      </div>
  </div>

  <!-- ì¢Œì¸¡ íˆ´ë°” (ê²€ìƒ‰) -->
<div class="search-container">
    <input type="search" id="keyword" 
        onkeyup="filter()" autocomplete="off"
        onkeydown="if(event.keyCode === 13) { btnsearch_click(); }" 
        class="form-control" 
        placeholder="ê²€ìƒ‰ì–´ ì…ë ¥"/>
    <button id="searchBtn" onclick="btnsearch_click()">ê²€ìƒ‰</button>
</div>

  <!-- ìš°ì¸¡ íˆ´ë°” (ì¢Œí‘œ/ë³µì‚¬) -->
  <div class="toolbar-right">
    <input type="text" id="gpsyx" class="input-common" inputmode="none"
           value="35.2725308711779, 128.406307024695"/>
    <button id="btn_input_copy" class="btn-common">ë³µì‚¬</button>
  </div>

  <!-- í•˜ë‹¨ ì»¨íŠ¸ë¡¤ -->
  <div class="custom_typecontrol2_m radius_border">
    <span id="toggle_group" class="btn btn-common">íšŒì„ </span>
    <span id="btnCurrentMe" class="btn btn-common" onclick="toggleMyLocation()">ìœ„ì¹˜</span>
    <span id="btnTrackMe" class="btn btn-common" onclick="toggleTracking()">ì¶”ì </span>
  </div>
    
</body>

<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=2634b7b6dd61e41a4d6c0bf40a2ef820&libraries=services,clusterer,drawing"></script>
<script src="https://code.jquery.com/jquery-3.6.1.js" integrity="sha256-3zlB5s2uwoUzrXK3BT7AX3FyvojsraNFxCc2vC/7pNI=" crossorigin="anonymous"></script>
<!-- ë§ˆì»¤ë¥¼ í‘œì‹œí•  ìœ„ì¹˜ì™€ ë‚´ìš©ì„ ê°€ì§€ê³  ìˆëŠ” ê°ì²´ ë°°ì—´ì…ë‹ˆë‹¤  -->
<!-- ë§ˆì»¤ìœ„ì¹˜ positions.js ë¶ˆëŸ¬ì˜¤ê¸° -->
    <script type="text/javascript" src="https://hamancctv.github.io/5/positions.js"></script> 
    
    <script>
        const toggleGroupBtn = document.getElementById('toggle_group');
toggleGroupBtn.addEventListener('click', function() {
    drawGroupLinesMST();

    // í† ê¸€ í´ë˜ìŠ¤ ì ìš©
    if (toggleGroupBtn.classList.contains('selected_btn')) {
        toggleGroupBtn.classList.remove('selected_btn');
    } else {
        toggleGroupBtn.classList.add('selected_btn');
    }
});
var overlayOn = false, // ì§€ë„ ìœ„ì— ë¡œë“œë·° ì˜¤ë²„ë ˆì´ê°€ ì¶”ê°€ëœ ìƒíƒœë¥¼ ê°€ì§€ê³  ìˆì„ ë³€ìˆ˜
    container = document.getElementById('container'), // ì§€ë„ì™€ ë¡œë“œë·°ë¥¼ ê°ì‹¸ê³  ìˆëŠ” div ì…ë‹ˆë‹¤
    mapWrapper = document.getElementById('mapWrapper'), // ì§€ë„ë¥¼ ê°ì‹¸ê³  ìˆëŠ” div ì…ë‹ˆë‹¤
    mapContainer = document.getElementById('map'), // ì§€ë„ë¥¼ í‘œì‹œí•  div ì…ë‹ˆë‹¤ 
    rvContainer = document.getElementById('roadview'); //ë¡œë“œë·°ë¥¼ í‘œì‹œí•  div ì…ë‹ˆë‹¤


var mapCenter = new kakao.maps.LatLng(35.2725308711779, 128.406307024695), // ì§€ë„ì˜ ì¤‘ì‹¬ì¢Œí‘œ
    mapOption = {
        center: mapCenter, // ì§€ë„ì˜ ì¤‘ì‹¬ì¢Œí‘œ
        level: 4, // ì§€ë„ì˜ í™•ëŒ€ ë ˆë²¨ 
	              //  mapTypeId: kakao.maps.MapTypeId.HYBRID

    };

// ì§€ë„ë¥¼ í‘œì‹œí•  divì™€ ì§€ë„ ì˜µì…˜ìœ¼ë¡œ ì§€ë„ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
var map = new kakao.maps.Map(mapContainer, mapOption);
map.setMaxLevel(9);
        
        

// ë¡œë“œë·° ê°ì²´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤ 
var rv = new kakao.maps.Roadview(rvContainer); 

// ì¢Œí‘œë¡œë¶€í„° ë¡œë“œë·° íŒŒë…¸ë¼ë§ˆ IDë¥¼ ê°€ì ¸ì˜¬ ë¡œë“œë·° í´ë¼ì´ì–¸íŠ¸ ê°ì²´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤ 
var rvClient = new kakao.maps.RoadviewClient(); 

// ë¡œë“œë·°ì— ì¢Œí‘œê°€ ë°”ë€Œì—ˆì„ ë•Œ ë°œìƒí•˜ëŠ” ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤ 
kakao.maps.event.addListener(rv, 'position_changed', function() {

    // í˜„ì¬ ë¡œë“œë·°ì˜ ìœ„ì¹˜ ì¢Œí‘œë¥¼ ì–»ì–´ì˜µë‹ˆë‹¤ 
    var rvPosition = rv.getPosition();

    // ì§€ë„ì˜ ì¤‘ì‹¬ì„ í˜„ì¬ ë¡œë“œë·°ì˜ ìœ„ì¹˜ë¡œ ì„¤ì •í•©ë‹ˆë‹¤
    map.setCenter(rvPosition);

    // ì§€ë„ ìœ„ì— ë¡œë“œë·° ë„ë¡œ ì˜¤ë²„ë ˆì´ê°€ ì¶”ê°€ëœ ìƒíƒœì´ë©´
    if(overlayOn) {
        // ë§ˆì»¤ì˜ ìœ„ì¹˜ë¥¼ í˜„ì¬ ë¡œë“œë·°ì˜ ìœ„ì¹˜ë¡œ ì„¤ì •í•©ë‹ˆë‹¤
        marker.setPosition(rvPosition);
    }
});

// ë§ˆì»¤ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
var markImage = new kakao.maps.MarkerImage(
    'https://t1.daumcdn.net/localimg/localimages/07/2018/pc/roadview_minimap_wk_2018.png',
    new kakao.maps.Size(26, 46),
    {
        // ìŠ¤í”„ë¼ì´íŠ¸ ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
        // ìŠ¤í”„ë¼ì´íŠ¸ ì´ë¯¸ì§€ ì „ì²´ì˜ í¬ê¸°ë¥¼ ì§€ì •í•˜ê³ 
        spriteSize: new kakao.maps.Size(1666, 168),
        // ì‚¬ìš©í•˜ê³  ì‹¶ì€ ì˜ì—­ì˜ ì¢Œìƒë‹¨ ì¢Œí‘œë¥¼ ì…ë ¥í•©ë‹ˆë‹¤.
        // background-positionìœ¼ë¡œ ì§€ì •í•˜ëŠ” ê°’ì´ë©° ë¶€í˜¸ëŠ” ë°˜ëŒ€ì…ë‹ˆë‹¤.
        spriteOrigin: new kakao.maps.Point(705, 114),
        offset: new kakao.maps.Point(13, 46)
    }
);

// ë“œë˜ê·¸ê°€ ê°€ëŠ¥í•œ ë§ˆì»¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
var marker = new kakao.maps.Marker({
    image : markImage,
    position: mapCenter,
    draggable: true
});

// ë§ˆì»¤ì— dragend ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤
kakao.maps.event.addListener(marker, 'dragend', function(mouseEvent) {

    // í˜„ì¬ ë§ˆì»¤ê°€ ë†“ì¸ ìë¦¬ì˜ ì¢Œí‘œì…ë‹ˆë‹¤ 
    var position = marker.getPosition();

    // ë§ˆì»¤ê°€ ë†“ì¸ ìœ„ì¹˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë¡œë“œë·°ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤
    toggleRoadview(position);
});

//ì§€ë„ì— í´ë¦­ ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤
kakao.maps.event.addListener(map, 'click', function(mouseEvent){
    
    // ì§€ë„ ìœ„ì— ë¡œë“œë·° ë„ë¡œ ì˜¤ë²„ë ˆì´ê°€ ì¶”ê°€ëœ ìƒíƒœê°€ ì•„ë‹ˆë©´ í´ë¦­ì´ë²¤íŠ¸ë¥¼ ë¬´ì‹œí•©ë‹ˆë‹¤ 
    if(!overlayOn) {
        return;
    }

    // í´ë¦­í•œ ìœ„ì¹˜ì˜ ì¢Œí‘œì…ë‹ˆë‹¤ 
    var position = mouseEvent.latLng;

    // ë§ˆì»¤ë¥¼ í´ë¦­í•œ ìœ„ì¹˜ë¡œ ì˜®ê¹ë‹ˆë‹¤
    marker.setPosition(position);

    // í´ë½í•œ ìœ„ì¹˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë¡œë“œë·°ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤
    toggleRoadview(position);
});

// ì „ë‹¬ë°›ì€ ì¢Œí‘œ(position)ì— ê°€ê¹Œìš´ ë¡œë“œë·°ì˜ íŒŒë…¸ë¼ë§ˆ IDë¥¼ ì¶”ì¶œí•˜ì—¬
// ë¡œë“œë·°ë¥¼ ì„¤ì •í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤
function toggleRoadview(position){
    rvClient.getNearestPanoId(position, 50, function(panoId) {
        // íŒŒë…¸ë¼ë§ˆ IDê°€ null ì´ë©´ ë¡œë“œë·°ë¥¼ ìˆ¨ê¹ë‹ˆë‹¤
        if (panoId === null) {
            toggleMapWrapper(true, position);
        } else {
         toggleMapWrapper(false, position);

            // panoIdë¡œ ë¡œë“œë·°ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤
            rv.setPanoId(panoId, position);
        }
    });
}

// ì§€ë„ë¥¼ ê°ì‹¸ê³  ìˆëŠ” divì˜ í¬ê¸°ë¥¼ ì¡°ì •í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤
function toggleMapWrapper(active, position) {
    if (active) {

        // ì§€ë„ë¥¼ ê°ì‹¸ê³  ìˆëŠ” divì˜ ë„ˆë¹„ê°€ 100%ê°€ ë˜ë„ë¡ classë¥¼ ë³€ê²½í•©ë‹ˆë‹¤ 
        container.className = '';

        // ì§€ë„ì˜ í¬ê¸°ê°€ ë³€ê²½ë˜ì—ˆê¸° ë•Œë¬¸ì— relayout í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤
        map.relayout();

        // ì§€ë„ì˜ ë„ˆë¹„ê°€ ë³€ê²½ë  ë•Œ ì§€ë„ì¤‘ì‹¬ì„ ì…ë ¥ë°›ì€ ìœ„ì¹˜(position)ë¡œ ì„¤ì •í•©ë‹ˆë‹¤
        map.setCenter(position);
    } else {

        // ì§€ë„ë§Œ ë³´ì—¬ì§€ê³  ìˆëŠ” ìƒíƒœì´ë©´ ì§€ë„ì˜ ë„ˆë¹„ê°€ 50%ê°€ ë˜ë„ë¡ classë¥¼ ë³€ê²½í•˜ì—¬
        // ë¡œë“œë·°ê°€ í•¨ê»˜ í‘œì‹œë˜ê²Œ í•©ë‹ˆë‹¤
        if (container.className.indexOf('view_roadview') === -1) {
            container.className = 'view_roadview';

            // ì§€ë„ì˜ í¬ê¸°ê°€ ë³€ê²½ë˜ì—ˆê¸° ë•Œë¬¸ì— relayout í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤
            map.relayout();

            // ì§€ë„ì˜ ë„ˆë¹„ê°€ ë³€ê²½ë  ë•Œ ì§€ë„ì¤‘ì‹¬ì„ ì…ë ¥ë°›ì€ ìœ„ì¹˜(position)ë¡œ ì„¤ì •í•©ë‹ˆë‹¤
            map.setCenter(position);
        }
    }
}

// ì§€ë„ ìœ„ì˜ ë¡œë“œë·° ë„ë¡œ ì˜¤ë²„ë ˆì´ë¥¼ ì¶”ê°€,ì œê±°í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤
function toggleOverlay(active) {
    if (active) {
        overlayOn = true;

        // ì§€ë„ ìœ„ì— ë¡œë“œë·° ë„ë¡œ ì˜¤ë²„ë ˆì´ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤
        map.addOverlayMapTypeId(kakao.maps.MapTypeId.ROADVIEW);

        // ì§€ë„ ìœ„ì— ë§ˆì»¤ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤
        marker.setMap(map);
        marker1.setMap(null); //fë¡œë“œë·° ì˜¤ë²„ë ˆì´ì¼ ë•Œ í´ë¦­ë§ˆì»¤ ì§€ì›€

        // ë§ˆì»¤ì˜ ìœ„ì¹˜ë¥¼ ì§€ë„ ì¤‘ì‹¬ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤ 
        marker.setPosition(map.getCenter());

        // ë¡œë“œë·°ì˜ ìœ„ì¹˜ë¥¼ ì§€ë„ ì¤‘ì‹¬ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤
        toggleRoadview(map.getCenter());
    } else {
        overlayOn = false;

        // ì§€ë„ ìœ„ì˜ ë¡œë“œë·° ë„ë¡œ ì˜¤ë²„ë ˆì´ë¥¼ ì œê±°í•©ë‹ˆë‹¤
        map.removeOverlayMapTypeId(kakao.maps.MapTypeId.ROADVIEW);

        // ì§€ë„ ìœ„ì˜ ë§ˆì»¤ë¥¼ ì œê±°í•©ë‹ˆë‹¤
        marker.setMap(null);
                marker1.setMap(map); //fë¡œë“œë·° ì˜¤ë²„ë ˆì´ì¼ ë•Œ í´ë¦­ë§ˆì»¤ ì§€ì›€

    }
}

// ì§€ë„ ìœ„ì˜ ë¡œë“œë·° ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤
function setRoadviewRoad() {
    var control = document.getElementById('roadviewControl');

    // ë²„íŠ¼ì´ ëˆŒë¦° ìƒíƒœê°€ ì•„ë‹ˆë©´
    if (control.className.indexOf('active') === -1) {
        control.className = 'active';

        // ë¡œë“œë·° ë„ë¡œ ì˜¤ë²„ë ˆì´ê°€ ë³´ì´ê²Œ í•©ë‹ˆë‹¤
        toggleOverlay(true);
    } else {
        control.className = '';

        // ë¡œë“œë·° ë„ë¡œ ì˜¤ë²„ë ˆì´ë¥¼ ì œê±°í•©ë‹ˆë‹¤
        toggleOverlay(false);
    }
}

// ë¡œë“œë·°ì—ì„œ Xë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ ë¡œë“œë·°ë¥¼ ì§€ë„ ë’¤ë¡œ ìˆ¨ê¸°ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤
function closeRoadview() {
    var position = marker.getPosition();
    toggleMapWrapper(true, position);
}

function setCenter(Lat, Lng) {
    // ì´ë™í•  ìœ„ë„ ê²½ë„ ìœ„ì¹˜ë¥¼ ìƒì„±í•©ë‹ˆë‹¤ 
    var moveLatLon = new daum.maps.LatLng(Lat, Lng);
  map.setLevel(1);

    // ì§€ë„ ì¤‘ì‹¬ì„ ì´ë™ ì‹œí‚µë‹ˆë‹¤
    map.panTo(moveLatLon);
var circle = new daum.maps.Circle({
    center : new daum.maps.LatLng(Lat,  Lng),  // ì›ì˜ ì¤‘ì‹¬ì¢Œí‘œ ì…ë‹ˆë‹¤ 
    radius: 50, // ë¯¸í„° ë‹¨ìœ„ì˜ ì›ì˜ ë°˜ì§€ë¦„ì…ë‹ˆë‹¤ 
    strokeWeight: 1, // ì„ ì˜ ë‘ê»˜ì…ë‹ˆë‹¤ 
    strokeColor: '#ffa500', // ì„ ì˜ ìƒ‰ê¹”ì…ë‹ˆë‹¤
    strokeOpacity: 1, // ì„ ì˜ ë¶ˆíˆ¬ëª…ë„ ì…ë‹ˆë‹¤ 1ì—ì„œ 0 ì‚¬ì´ì˜ ê°’ì´ë©° 0ì— ê°€ê¹Œìš¸ìˆ˜ë¡ íˆ¬ëª…í•©ë‹ˆë‹¤
    strokeStyle: 'dashed', // ì„ ì˜ ìŠ¤íƒ€ì¼ ì…ë‹ˆë‹¤
    fillColor: '#FF1000', // ì±„ìš°ê¸° ìƒ‰ê¹”ì…ë‹ˆë‹¤
    fillOpacity: 0.3  // ì±„ìš°ê¸° ë¶ˆíˆ¬ëª…ë„ ì…ë‹ˆë‹¤   
}); 

// ì§€ë„ì— ì›ì„ í‘œì‹œí•©ë‹ˆë‹¤ 
circle.setMap(map);     
setTimeout(function(){
circle.setMap(null);    ;
}, 1000);        
}

// ì¼ë°˜ ì§€ë„ì™€ ìŠ¤ì¹´ì´ë·°ë¡œ ì§€ë„ íƒ€ì…ì„ ì „í™˜í•  ìˆ˜ ìˆëŠ” ì§€ë„íƒ€ì… ì»¨íŠ¸ë¡¤ì„ ìƒì„±í•©ë‹ˆë‹¤
var mapTypeControl = new kakao.maps.MapTypeControl();
// ì§€ë„ì— ì»¨íŠ¸ë¡¤ì„ ì¶”ê°€í•´ì•¼ ì§€ë„ìœ„ì— í‘œì‹œë©ë‹ˆë‹¤
// kakao.maps.ControlPositionì€ ì»¨íŠ¸ë¡¤ì´ í‘œì‹œë  ìœ„ì¹˜ë¥¼ ì •ì˜í•˜ëŠ”ë° TOPRIGHTëŠ” ì˜¤ë¥¸ìª½ ìœ„ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤
map.addControl(mapTypeControl, kakao.maps.ControlPosition.TOPLEFT);

// ì§€ë„ í™•ëŒ€ ì¶•ì†Œë¥¼ ì œì–´í•  ìˆ˜ ìˆëŠ”  ì¤Œ ì»¨íŠ¸ë¡¤ì„ ìƒì„±í•©ë‹ˆë‹¤
// var zoomControl = new kakao.maps.ZoomControl();
// map.addControl(zoomControl, kakao.maps.ControlPosition.LEFT);

        
        // ë‚´ ìœ„ì¹˜ í† ê¸€//
  var myLocationOn = false;
var trackOn = false;
var myLocationMarker = null;
var trackMarker = null;
var trackInterval = null;
var watchId = null;

var markerImage = new kakao.maps.MarkerImage(
    'https://hamancctv.github.io/5/icon-target.png',
    new kakao.maps.Size(32,32),
    { offset: new kakao.maps.Point(16,16) }
);

// ===== ë‚´ ìœ„ì¹˜ í† ê¸€ =====
function toggleMyLocation() {
    if(trackOn) stopTracking(); // ì¶”ì  ì¼œì ¸ ìˆìœ¼ë©´ ë”

    if(!myLocationOn){
        myLocationOn = true;
        document.getElementById('btnCurrentMe').classList.add('selected_btn');
        navigator.geolocation.getCurrentPosition(function(pos){
            showMyLocation(pos.coords.latitude, pos.coords.longitude);
        }, geoError, { enableHighAccuracy:true });
    } else {
        myLocationOn = false;
        document.getElementById('btnCurrentMe').classList.remove('selected_btn');
        if(myLocationMarker) {
            myLocationMarker.setMap(null);
            myLocationMarker = null;
        }
    }
}

function showMyLocation(lat, lng){
    var latLng = new kakao.maps.LatLng(lat,lng);
    if(!myLocationMarker){
        myLocationMarker = new kakao.maps.Marker({
            position:latLng,
            map:map,
            image:markerImage
        });
        kakao.maps.event.addListener(myLocationMarker, 'click', function(){
            map.panTo(myLocationMarker.getPosition());
            map.setLevel(4);
        });
    } else {
        myLocationMarker.setPosition(latLng);
        myLocationMarker.setMap(map);
    }
    map.panTo(latLng);
    map.setLevel(5);
}

// ===== ì¶”ì  í† ê¸€ =====
function toggleTracking() {
    if(myLocationOn) toggleMyLocation(); // ë‚´ìœ„ì¹˜ ì¼œì ¸ ìˆìœ¼ë©´ ë”

    if(!trackOn) startTracking();
    else stopTracking();
}

function startTracking(){
    trackOn = true;
    document.getElementById('btnTrackMe').classList.add('selected_btn');

    watchId = navigator.geolocation.watchPosition(function(pos){
        var latLng = new kakao.maps.LatLng(pos.coords.latitude,pos.coords.longitude);

        if(!trackMarker){
            trackMarker = new kakao.maps.Marker({
                position:latLng,
                map:map,
                image:markerImage
            });
        } else {
            trackMarker.setPosition(latLng);
            trackMarker.setMap(map);
        }
        map.panTo(latLng);
    }, geoError, { enableHighAccuracy:true });

    trackInterval = setInterval(function(){
        if(trackMarker) trackMarker.setVisible(!trackMarker.getVisible());
    }, 500); // ê¹œë¹¡ì„ ì†ë„ 0.5ì´ˆ
}

function stopTracking(){
    trackOn = false;
    document.getElementById('btnTrackMe').classList.remove('selected_btn');

    if(watchId) { navigator.geolocation.clearWatch(watchId); watchId=null; }
    if(trackInterval){ clearInterval(trackInterval); trackInterval=null; }
    if(trackMarker){ trackMarker.setVisible(true); trackMarker.setMap(null); trackMarker=null; }
}

function geoError(err){ console.error('GPS error:', err); }

    // ì¤‘ë³µ ì œê±° ë¡œì§
// unique ê°ì²´ì— lat, lng ë¿ë§Œ ì•„ë‹ˆë¼ markerImageë„ ì²´í¬í•˜ì—¬ ì™„ë²½í•œ ì¤‘ë³µ ì œê±°
var unique = {};
var filtered = [];
for (var i = 0; i < positions.length; i++) {
    var lat = positions[i].latlng.getLat();
    var lng = positions[i].latlng.getLng();
    var key = lat + ',' + lng;

    // ì´ë¯¸ì§€ ì •ë³´ë¥¼ í‚¤ì— ì¶”ê°€í•˜ì—¬ ì •í™•í•œ ì¤‘ë³µì„ ì œê±°
    if (!unique[key]) {
        unique[key] = true;
        filtered.push(positions[i]); // ëŒ€í‘œ ë§ˆì»¤ë§Œ ì €ì¥
    }
}
 
// ë§ˆì»¤ ìƒì„± ë° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ ë¡œì§
var markers = [];
var overlays = [];
var clickOverlays = [];
var polyline = null;
var markerHeight = 42;

for (var i = 0; i < filtered.length; i++) {
    (function(i) {
        var marker2 = new kakao.maps.Marker({
            map: map,
            position: filtered[i].latlng,
            image: filtered[i].markerImage, // filtered ë°ì´í„°ì˜ markerImage ì‚¬ìš©
            clickable: true
        });

         // hoverìš© overlay
        var overlay = new kakao.maps.CustomOverlay({
            position: filtered[i].latlng,
            content: `<div style="
                padding:2px 6px;
                background:rgba(255,255,255,0.9);
                border:1px solid #ccc;
                border-radius:5px;
                font-size:12px;
                white-space: nowrap;
                transform: translateY(-${markerHeight}px);
                user-select: none;
            ">${filtered[i].content}</div>`,
            yAnchor: 1,
            map: null,
            clickable: false
        });

        // í´ë¦­ìš© overlay
        var clickOverlay = new kakao.maps.CustomOverlay({
            position: filtered[i].latlng,
            content: `<div style="
                padding:5px 8px;
                background:rgba(255,255,255,0.95);
                border:1px solid #666;
                border-radius:5px;
                font-size:13px;
                white-space: nowrap;
                transform: translateY(-${markerHeight}px);
                user-select: none;
            ">${filtered[i].content}</div>`,
            yAnchor: 1,
            map: null,
            clickable: false
        });

        // hover ì´ë²¤íŠ¸
        kakao.maps.event.addListener(marker2, 'mouseover', function() {
            if(map.getLevel() > 3 && overlay.getMap() === null) overlay.setMap(map);
        });
        kakao.maps.event.addListener(marker2, 'mouseout', function() {
            if(map.getLevel() > 3) setTimeout(function() {
                if(overlay.getMap() !== null) overlay.setMap(null);
            }, 50);
        });
        
        
        // í´ë¦­ ì´ë²¤íŠ¸
    // í´ë¦­ ì´ë²¤íŠ¸
kakao.maps.event.addListener(marker2, 'click', function() {
    // ê¸°ì¡´ ì˜¤ë²„ë ˆì´ ëª¨ë‘ ì œê±°
    clickOverlays.forEach(function(ov) {
        ov.setMap(null);
    });
    clickOverlays = [];

    // í´ë¦­í•œ ë§ˆì»¤ì˜ ê·¸ë£¹ í™•ì¸
    var group = marker2.group;

   
    
            
            // 2. ë°”ìš´ìŠ¤ íš¨ê³¼ ë° ì˜¤ë²„ë ˆì´ í‘œì‹œ
            var originalPosition = filtered[i].latlng;
            var offset = 0;
            var direction = 1;
            var bounceDuration = 400;

            if (marker2.bounceInterval) {
                clearInterval(marker2.bounceInterval);
            }

            marker2.bounceInterval = setInterval(function() {
                offset += direction * 0.5;
                if (offset >= 5 || offset <= -5) {
                    direction *= -1;
                }
                var bouncePosition = new kakao.maps.LatLng(
                    originalPosition.getLat(),
                    originalPosition.getLng() + (offset / 100000)
                );
                marker2.setPosition(bouncePosition);
            }, 10);

            setTimeout(function() {
                clearInterval(marker2.bounceInterval);
                marker2.setPosition(originalPosition);
            }, bounceDuration);

            clickOverlay.setMap(map);
            clickOverlays.push(clickOverlay);

            // sel_txt í•„í„°ë§ (ê¸°ì¡´ ë¡œì§ ìœ ì§€)
            // filtered[i].contentë¥¼ ì‚¬ìš©í•˜ë„ë¡ ìˆ˜ì •
            var value = filtered[i].content.substring(0, 5).toUpperCase();
            var items = document.getElementsByClassName("sel_txt");
            for (var j = 0; j < items.length; j++) {
                var nameElem = items[j].getElementsByClassName("name")[0];
                items[j].style.display = (nameElem && nameElem.innerHTML.toUpperCase().indexOf(value) > -1) ? "flex" : "none";
            }
            
                            // í´ë¦­í•œ ìœ„ë„, ê²½ë„ ì •ë³´ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤
  var latlng = marker2.getPosition();
    // inputì— ì¢Œí‘œ ë„£ê¸°
    $('#gpsyx').val(latlng.getLat() + ', ' + latlng.getLng());
        });

        // ë§ˆì»¤ ê°ì²´ì— ê·¸ë£¹ ì •ë³´ ì €ì¥
        marker2.group = filtered[i].group;
        markers.push(marker2);
        overlays.push(overlay);
    })(i);
}
    
    
// ì§€ë„ ë ˆë²¨ ë³€ê²½ ê°ì§€
kakao.maps.event.addListener(map, 'idle', function() {
    var level = map.getLevel();
    overlays.forEach(function(o) {
        if(level <= 3) o.setMap(map);
        else o.setMap(null);
    });
});

// ì§€ë„ í´ë¦­ â†’ í´ë¦¬ë¼ì¸ ë° í´ë¦­ ì˜¤ë²„ë ˆì´ ì‚­ì œ
kakao.maps.event.addListener(map, 'click', function() {
    if (polyline) {
        polyline.setMap(null);
        polyline = null;
    }
    clickOverlays.forEach(function(o){ o.setMap(null); });
    clickOverlays = [];
});
        


$(()=>{
  // make divs with an onclick attribute tabbable/clickable
  $('div[onclick]')
    .attr('tabindex', '0')                     // Add tab indexes
    .keypress((evt)=>{
    var key = evt.key;
    evt.preventDefault();                  // Ensure all default keypress
    // actions are not used
    if (key === ' ' || key === 'Enter') {  // Only send click events for Space
      // or Enter keys
      evt.currentTarget.click();         // Run the click event for element
    }
  });
 			
  // activate the first clickable div

});
 
    
   // ì§€ë„ê°€ ì´ë™, í™•ëŒ€, ì¶•ì†Œë¡œ ì¸í•´ ì¤‘ì‹¬ì¢Œí‘œê°€ ë³€ê²½ë˜ë©´ ë§ˆì§€ë§‰ íŒŒë¼ë¯¸í„°ë¡œ ë„˜ì–´ì˜¨ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë„ë¡ ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤
kakao.maps.event.addListener(map, 'center_changed', function() {

    // ì§€ë„ì˜  ë ˆë²¨ì„ ì–»ì–´ì˜µë‹ˆë‹¤
    var level = map.getLevel();
    // ì§€ë„ì˜ ì¤‘ì‹¬ì¢Œí‘œë¥¼ ì–»ì–´ì˜µë‹ˆë‹¤ 
    var latlng = map.getCenter(); 
        $('#gpsyx').val(latlng.getLat() + ', ' + latlng.getLng());  
});
    
// ì „ì—­ ë³€ìˆ˜ (ê²€ìƒ‰ ì‹¤íŒ¨ íšŸìˆ˜ ì¹´ìš´íŠ¸)
var searchFailCount = 0;

function btnsearch_click() {
    $(':focus').blur();

    var bounds = new kakao.maps.LatLngBounds(
      new kakao.maps.LatLng(35.119382493091855, 128.18218076324376), // ë‚¨ì„œìª½ ì¢Œí‘œ
      new kakao.maps.LatLng(35.42383291087308, 128.59320201946082)  // ë¶ë™ìª½ ì¢Œí‘œ
    );

    var geocoder = new kakao.maps.services.Geocoder();
    var geocoderOptions = { bounds: bounds };

    // ì£¼ì†Œ ê²€ìƒ‰
    geocoder.addressSearch($('#keyword').val(), function(result, status) {
        handleSearchResult(result, status, 'address');
    }, geocoderOptions);

    var ps = new kakao.maps.services.Places();
    var psOptions = { bounds: bounds };

    // í‚¤ì›Œë“œ ê²€ìƒ‰
    ps.keywordSearch("í•¨ì•ˆêµ° " + $('#keyword').val(), function(data, status, pagination) {
        handleSearchResult(data, status, 'keyword');
    }, psOptions);

    // ê²€ìƒ‰ ì‹œì‘í•  ë•Œ ì‹¤íŒ¨ ì¹´ìš´íŠ¸ ì´ˆê¸°í™”
    searchFailCount = 0;
}

// ê³µí†µ ì²˜ë¦¬ í•¨ìˆ˜
function handleSearchResult(data, status, searchType) {
    if (status === kakao.maps.services.Status.OK && data.length > 0) {
        var coords = new kakao.maps.LatLng(data[0].y, data[0].x);

        var circle = new kakao.maps.Circle({
            center: coords,
            radius: 50,
            strokeWeight: 1,
            strokeColor: '#ffa500',
            strokeOpacity: 1,
            strokeStyle: 'dashed',
            fillColor: '#FF1000',
            fillOpacity: 0.3
        });

        circle.setMap(map);
        setTimeout(function() {
            circle.setMap(null);
        }, 1000);

        map.setLevel(2);
        map.setCenter(coords);

        // ğŸ”¹ ì„±ê³µí–ˆìœ¼ë©´ ì‹¤íŒ¨ ì¹´ìš´íŠ¸ ë¦¬ì…‹
        searchFailCount = 0;

    } else {
        // ğŸ”¹ ê²€ìƒ‰ ì‹¤íŒ¨ ì‹œ ì¹´ìš´íŠ¸ ì¦ê°€
        searchFailCount++;

        if (searchFailCount >= 2) {
            showAlert("ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.");
            $('#keyword').focus();
        }
    }
}
// âœ… 7. ì˜¤ë²„ë ˆì´ ê²½ê³ ì°½ì„ ë³´ì—¬ì£¼ëŠ” í•¨ìˆ˜
function showAlert(message) {
    const alertOverlay = $('#alert-overlay');
    const alertMessage = $('#alert-message');
    alertMessage.text(message);
    alertOverlay.fadeIn(300);

    setTimeout(function() {
        alertOverlay.fadeOut(500);
    }, 3000);
}


    
// ì§€ë„ë¥¼ í´ë¦­í•œ ìœ„ì¹˜ì— í‘œì¶œí•  ë§ˆì»¤ì…ë‹ˆë‹¤
    var imageSrc = 'https://raw.githubusercontent.com/kang-chan/hamancctv2/main/rainbow.png', // ë§ˆì»¤ì´ë¯¸ì§€ì˜ ì£¼ì†Œì…ë‹ˆë‹¤    
    imageSize = new kakao.maps.Size(40, 50), // ë§ˆì»¤ì´ë¯¸ì§€ì˜ í¬ê¸°ì…ë‹ˆë‹¤
    imageOption = {offset: new kakao.maps.Point(20, 45)}; // ë§ˆì»¤ì´ë¯¸ì§€ì˜ ì˜µì…˜ì…ë‹ˆë‹¤. ë§ˆì»¤ì˜ ì¢Œí‘œì™€ ì¼ì¹˜ì‹œí‚¬ ì´ë¯¸ì§€ ì•ˆì—ì„œì˜ ì¢Œí‘œë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
      


    
// ì§€ë„ì— í´ë¦­ ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤
// ì§€ë„ë¥¼ í´ë¦­í•˜ë©´ ë§ˆì§€ë§‰ íŒŒë¼ë¯¸í„°ë¡œ ë„˜ì–´ì˜¨ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤
kakao.maps.event.addListener(map, 'click', function(mouseEvent) {        

    // í´ë¦­í•œ ìœ„ë„, ê²½ë„ ì •ë³´ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤
    var latlng = mouseEvent.latLng;
    // ë§ˆì»¤ ìœ„ì¹˜ë¥¼ í´ë¦­í•œ ìœ„ì¹˜ë¡œ ì˜®ê¹ë‹ˆë‹¤
//    marker1.setPosition(latlng);

    //alert(message);
// ì¢Œí‘œ inputì— ì¢Œí‘œ ë„£ê¸°
    $('#gpsyx').val(latlng.getLat() + ', ' + latlng.getLng());  
});


    
</script>



    <!-- sel_txt ì‹œì‘ -->
<div id="menu_wrap" class="bg_white" style="border:1px solid #919191;border-radius:10px;">
    <!-- ì´ ì‚¬ì´ì— ë‚´ìš© í˜¸ì¶œ -->
    </div>
<script>
    fetch("https://raw.githubusercontent.com/hamancctv/5/refs/heads/main/sel_txt.html")  // ì™¸ë¶€ íŒŒì¼ ê²½ë¡œ
  .then(response => response.text())
  .then(html => {
    document.getElementById("menu_wrap").innerHTML = html;
  })
  .catch(err => console.error("ë©”ë‰´ ë¡œë“œ ì‹¤íŒ¨:", err));
</script>
    <!-- ìœ„ ìë°”ìŠ¤í¬ë¦½íŠ¸ê°€ ë‚´ìš© í˜¸ì¶œ ìŠ¤í¬ë¦½íŠ¸ê³  ì´ìƒ ë. -->
    
    
<script type="text/javascript">
      function filter(){

        var value, name, item, i;

        value = document.getElementById("keyword").value.toUpperCase();
        item = document.getElementsByClassName("sel_txt");

        for(i=0;i<item.length;i++){
          name = item[i].getElementsByClassName("name");
          if(name[0].innerHTML.toUpperCase().indexOf(value) > -1){
            item[i].style.display = "flex";
          }else{
            item[i].style.display = "none";
          }
        }
      };
    

function removeMarker() {
    for ( var i = 0; i < markers.length; i++ ) {
        markers[i].setMap(null);
    }
    markers = [];
}
     // 2-2. input:text ë³µì‚¬
	  
    document.getElementById("btn_input_copy").onclick = function(){
        const input_text = document.getElementById("gpsyx");
        gpsyx.select();
        document.execCommand('copy');
    };

    // ì „ì—­ ë³€ìˆ˜
// ê·¸ë£¹ë³„ ì§ì„  ì—°ê²°
// ê±°ë¦¬ ê³„ì‚° í•¨ìˆ˜
function getDistance(latlng1, latlng2){
    var R = 6371e3;
    var lat1 = latlng1.getLat() * Math.PI / 180;
    var lat2 = latlng2.getLat() * Math.PI / 180;
    var dLat = (latlng2.getLat()-latlng1.getLat())*Math.PI/180;
    var dLng = (latlng2.getLng()-latlng1.getLng())*Math.PI/180;
    var a = Math.sin(dLat/2)**2 + Math.cos(lat1)*Math.cos(lat2)*Math.sin(dLng/2)**2;
    var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    return R*c;
}

// MST í† ê¸€
var allLines = [];
function drawGroupLinesMST(){
    if(allLines.length>0){
        allLines.forEach(l=>l.setMap(null));
        allLines=[];
        return;
    }

    var groupMarkers={};
    markers.forEach(m=>{
        if(!m.group) return;
        if(!groupMarkers[m.group]) groupMarkers[m.group]=[];
        groupMarkers[m.group].push(m);
    });

    for(var g in groupMarkers){
        var group = groupMarkers[g];
        if(group.length<2) continue;

        var n=group.length, selected=Array(n).fill(false), dist=Array(n).fill(Infinity), parent=Array(n).fill(-1);
        dist[0]=0;

        for(var k=0;k<n;k++){
            var u=-1;
            for(var i=0;i<n;i++){
                if(!selected[i] && (u==-1 || dist[i]<dist[u])) u=i;
            }
            selected[u]=true;
            for(var v=0;v<n;v++){
                if(!selected[v]){
                    var d=getDistance(group[u].getPosition(), group[v].getPosition());
                    if(d<dist[v]) { dist[v]=d; parent[v]=u; }
                }
            }
        }

        for(var i=1;i<n;i++){
            var path=[group[i].getPosition(), group[parent[i]].getPosition()];
            var line = new kakao.maps.Polyline({
                path:path, strokeWeight:3, strokeColor:'#FF5C5C', strokeOpacity:0.7
            });
            line.setMap(map);
            allLines.push(line);
        }
    }
}

// ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
var drawing = false;
var currentGroup = null;
var groups = [];
var tempLine = null;

var btn = document.getElementById('btnDistance');
btn.addEventListener('click', function(){
    drawing = !drawing;
    if(drawing){
        resetAll();
        startNewGroup();
        map.setCursor('crosshair');
        btn.classList.add('active');
    } else {
        resetAll();
        map.setCursor('');
        btn.classList.remove('active');
    }
});

// ì§€ë„ í´ë¦­ â†’ ì„  ì¶”ê°€
kakao.maps.event.addListener(map, 'click', function(mouseEvent){
    if(!drawing || !currentGroup) return;
    var clickPos = mouseEvent.latLng;
    currentGroup.path.push(clickPos);

    if(currentGroup.path.length > 1){
        var polyline = new kakao.maps.Polyline({
            map: map,
            path: [currentGroup.path[currentGroup.path.length-2], clickPos],
            strokeWeight: 3,
            strokeColor: '#db4040',
            strokeOpacity: 1,
            strokeStyle: 'solid'
        });
        currentGroup.polylines.push(polyline);

        var segDist = polyline.getLength();
        addLabel(currentGroup, clickPos, segDist.toFixed(1) + ' m');
    }
});

// ë§ˆìš°ìŠ¤ ì´ë™ â†’ ì„ì‹œ ì ì„ 
kakao.maps.event.addListener(map, 'mousemove', function(mouseEvent){
    if(!drawing || !currentGroup || currentGroup.path.length===0) return;
    var movePos = mouseEvent.latLng;
    if(!tempLine){
        tempLine = new kakao.maps.Polyline({
            map: map,
            strokeWeight: 2,
            strokeColor: '#999',
            strokeOpacity: 0.8,
            strokeStyle: 'dash'
        });
    }
    tempLine.setPath([currentGroup.path[currentGroup.path.length-1], movePos]);
});

// ìƒˆ ê·¸ë£¹ ìƒì„±
function startNewGroup(){
    currentGroup = { path: [], polylines: [], overlays: [] };
    groups.push(currentGroup);
}

// í°ìƒ‰ ì‚¬ê°í˜• ë¼ë²¨ ì¶”ê°€
function addLabel(group, position, text){
    var content = document.createElement('div');
    content.className = 'labelBox';
    content.innerText = text;

    var overlay = new kakao.maps.CustomOverlay({
        content: content,
        position: position,
        pixelOffset: new kakao.maps.Point(0,-50) // ìœ„ìª½ 50px
    });
    overlay.setMap(map);
    group.overlays.push(overlay);

    // ë§ˆì§€ë§‰ ì‚¬ê°í˜• í´ë¦­ â†’ ëˆ„ì ê±°ë¦¬ í‘œì‹œ
    content.addEventListener('click', function(evt){
        if(evt){ evt.stopPropagation(); evt.preventDefault(); }

        var totalDist = getTotalDistance(group).toFixed(1) + ' m';
        var totalBox = document.createElement('div');
        totalBox.className = 'totalBox';
        totalBox.innerText = totalDist;

        var totalOverlay = new kakao.maps.CustomOverlay({
            content: totalBox,
            position: position,
            pixelOffset: new kakao.maps.Point(0,-50)
        });
        totalOverlay.setMap(map);
        group.overlays.push(totalOverlay);

        currentGroup = null;
        if(tempLine){ tempLine.setMap(null); tempLine=null; }

        startNewGroup(); // ë‹¤ìŒ í´ë¦­ë¶€í„° ìƒˆ ê·¸ë£¹ ì‹œì‘
    });
}

// ì „ì²´ ì´ˆê¸°í™”
function resetAll(){
    for(var i=groups.length-1;i>=0;i--){
        var g = groups[i];
        g.polylines.forEach(p=>p.setMap(null));
        g.overlays.forEach(o=>o.setMap(null));
    }
    groups = [];
    currentGroup=null;
    if(tempLine){ tempLine.setMap(null); tempLine=null; }
}

// ëˆ„ì ê±°ë¦¬ ê³„ì‚°
function getTotalDistance(group){
    var sum = 0;
    group.polylines.forEach(function(p){ sum += p.getLength(); });
    return sum;
}




    
    </script>

</body>
</html>
